<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark Mode Calculator with History</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: #1e1e1e;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding-top: 20px;
        }
        .calculator {
            max-width: 400px;
            width: 100%;
            background-color: #2a2a2a;
            border: 1px solid #333;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            overflow: hidden;
            margin-bottom: 20px;
            margin-top: 20px; /* Añadir margen arriba para espacio */
            z-index: 1; /* Asegurarse que la calculadora este sobre el historial */
        }
        .calculator-display {
            background-color: #3c3c3c;
            border-bottom: 1px solid #333;
            font-size: 2rem;
            text-align: right;
            padding: 10px;
            min-height: 60px;
            color: #fff;
        }
        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
        }
        .btn-calculator {
            font-size: 1.5rem;
            padding: 20px;
            border: none;
            outline: none;
            background-color: #444;
            color: #fff;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .btn-calculator.active {
            background-color: #555 !important;
        }
        .btn-calculator:hover {
            background-color: #555;
        }
        .btn-calculator.operator {
            background-color: #f3a847;
            color: #fff;
        }
        .btn-calculator.operator.active {
            background-color: #e6953c !important;
        }
        .btn-calculator.operator:hover {
            background-color: #e6953c;
        }
        .history {
            max-height: calc(100vh - 220px); /* Ajustar el espacio según tus necesidades */
            overflow-y: auto; /* Mantener el scroll si es necesario */
            width: 100%;
            padding: 10px;
            z-index: 0; /* Asegurarse que el historial este detrás de la calculadora */
        }
        .history-item {
            margin-bottom: 10px;
            border-bottom: 1px solid #555; /* Línea entre elementos del historial */
            padding-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .history-operation {
            font-size: 1rem;
            opacity: 0.8;
            text-align: left; /* Alinear operación a la izquierda */
        }
        .history-result {
            font-size: 1.2rem;
            font-weight: bold;
            text-align: right; /* Alinear resultado a la derecha */
        }
    </style>
</head>
<body>
    <h2 style="padding: 10px 0; text-align: left;">Calculator</h2>

    <div class="calculator">
        <div class="calculator-display" id="calculator-display">0</div>
        <div class="calculator-buttons">
            <button class="btn btn-calculator operator" data-operation="clear">C</button>
            <button class="btn btn-calculator operator" data-operation="divide">÷</button>
            <button class="btn btn-calculator operator" data-operation="multiply">×</button>
            <button class="btn btn-calculator operator" data-operation="delete">←</button>
            <button class="btn btn-calculator" data-value="7">7</button>
            <button class="btn btn-calculator" data-value="8">8</button>
            <button class="btn btn-calculator" data-value="9">9</button>
            <button class="btn btn-calculator operator" data-operation="subtract">-</button>
            <button class="btn btn-calculator" data-value="4">4</button>
            <button class="btn btn-calculator" data-value="5">5</button>
            <button class="btn btn-calculator" data-value="6">6</button>
            <button class="btn btn-calculator operator" data-operation="add">+</button>
            <button class="btn btn-calculator" data-value="1">1</button>
            <button class="btn btn-calculator" data-value="2">2</button>
            <button class="btn btn-calculator" data-value="3">3</button>
            <button class="btn btn-calculator operator" data-operation="calculate">=</button>
            <button class="btn btn-calculator" data-value="0">0</button>
            <button class="btn btn-calculator" data-value=".">.</button>
            <button class="btn btn-calculator operator" data-operation="clear-all">CE</button>
            <button class="btn btn-calculator operator" data-operation="negate">+/-</button>
        </div>
    </div>

    <div class="history">
        <h3 style="padding: 10px 0; text-align: center;">History</h3>
        <div class="history-container" id="history-container"></div>
    </div>

    <!-- Bootstrap JS (opcional, solo si necesitas funcionalidades de Bootstrap en JavaScript) -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> -->

    <script>
        const displayElement = document.getElementById('calculator-display');
        const historyContainer = document.getElementById('history-container');
        let currentInput = '';
        let currentOperation = null;
        let buffer = '';

        document.querySelectorAll('.btn-calculator').forEach(button => {
            button.addEventListener('click', () => {
                const { value, operation } = button.dataset;

                // Remove active class from all buttons
                document.querySelectorAll('.btn-calculator').forEach(btn => {
                    btn.classList.remove('active');
                });

                // Add active class to the clicked button
                button.classList.add('active');

                if (operation === 'clear') {
                    clearDisplay();
                } else if (operation === 'delete') {
                    deleteLastDigit();
                } else if (operation === 'calculate') {
                    calculateResult();
                } else if (operation === 'clear-all') {
                    clearAll();
                } else if (operation === 'negate') {
                    negateNumber();
                } else if (operation) {
                    handleOperation(operation);
                } else {
                    appendNumber(value);
                }
            });
        });

        function clearDisplay() {
            currentInput = '';
            currentOperation = null;
            buffer = '';
            updateDisplay('0');
        }

        function deleteLastDigit() {
            currentInput = currentInput.slice(0, -1);
            updateDisplay(currentInput);
        }

        function handleOperation(operation) {
            if (currentInput === '' && operation !== 'subtract') {
                return; // No se puede empezar con un operador (excepto resta negativa)
            }

            if (currentOperation && buffer && currentInput === '') {
                // Si ya hay una operación y buffer pero no hay un nuevo número ingresado
                currentOperation = operation;
                updateDisplay(buffer);
                return;
            }

            // Check if the same operator is clicked twice
            if (operation === currentOperation && buffer) {
                calculateResult();
                return;
            }

            // Si el botón anterior fue "=" y el siguiente es un número, limpiar la calculadora
            if (currentOperation === 'calculate' && !isNaN(parseInt(operation))) {
                clearDisplay();
            }

            currentOperation = operation;
            buffer = currentInput;
            currentInput = '';

            // Update display with buffer value when operator is clicked
            updateDisplay(buffer);
        }

        function appendNumber(number) {
            if (number === '.' && currentInput.includes('.')) return;
            currentInput += number;
            updateDisplay(currentInput);
        }

        function calculateResult() {
            let result;
            const num1 = parseFloat(buffer);
            const num2 = parseFloat(currentInput);

            switch (currentOperation) {
                case 'add':
                    result = num1 + num2;
                    break;
                case 'subtract':
                    result = num1 - num2;
                    break;
                case 'multiply':
                    result = num1 * num2;
                    break;
                case 'divide':
                    result = num1 / num2;
                    break;
                default:
                    return;
            }

            // Mostrar historial
            showHistory(`${buffer} ${getOperationSymbol(currentOperation)} ${currentInput}`, result);

            updateDisplay(result.toString());
            currentInput = result.toString();
            currentOperation = 'calculate'; // Marcar la operación como '=' para el siguiente click
        }

        function updateDisplay(value) {
            displayElement.textContent = value;
        }

        function showHistory(operation, result) {
            const historyItem = document.createElement('div');
            historyItem.classList.add('history-item');

            const operationLabel = document.createElement('div');
            operationLabel.classList.add('history-operation');
            operationLabel.textContent = operation;

            const resultLabel = document.createElement('div');
            resultLabel.classList.add('history-result');
            resultLabel.textContent = result;

            historyItem.appendChild(operationLabel);
            historyItem.appendChild(resultLabel);

            historyContainer.appendChild(historyItem);
        }

        function getOperationSymbol(operation) {
            switch (operation) {
                case 'add':
                    return '+';
                case 'subtract':
                    return '-';
                case 'multiply':
                    return '×';
                case 'divide':
                    return '÷';
                default:
                    return '';
            }
        }

        function clearAll() {
            clearDisplay();
            currentOperation = null;
            buffer = '';
        }

        function negateNumber() {
            currentInput = (parseFloat(currentInput) * -1).toString();
            updateDisplay(currentInput);
        }
    </script>
</body>
</html>
